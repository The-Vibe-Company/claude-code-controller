<!-- Generated by agents-reverse-engineer -->

# scripts

Shell utilities for managing the Vibe Companion development environment lifecycle, including server and frontend process orchestration, port health monitoring, and PID-based process cleanup.

## Contents

- [dev-start.sh](./dev-start.sh) — Idempotent bootstrap orchestrator for backend (port 3456) and Vite dev server (port 5174), exposing `--start`, `--stop`, `--status` commands with PID file tracking and HTTP health polling.

## Command Interface

`dev-start.sh` accepts three modes via CLI flag:
- Default (no flag) → `cmd_start`
- `--stop` → `cmd_stop`
- `--status` → `cmd_status`

Invoked by `make dev` in repository root.

## State Persistence

Four repository-root files track runtime state:
- `.dev-backend.pid` — PID of `bun --watch server/index.ts`
- `.dev-vite.pid` — PID of `bun run dev:vite`
- `.dev-backend.log` — stdout/stderr from backend process
- `.dev-vite.log` — stdout/stderr from Vite HMR server

## Port Health Checks

`is_port_listening` uses `lsof -iTCP:$port -sTCP:LISTEN -t` for port occupancy detection. `is_http_healthy` performs `curl --max-time 3` against `http://localhost:$port`, accepting HTTP 2xx/3xx. `wait_for_port` polls `is_http_healthy` every 1 second for max 60 seconds, dies with last 20 log lines on timeout.

## Process Lifecycle

`kill_by_pid_file` reads PID from file, sends `kill $pid`, removes PID file. `kill_on_port` combines `get_pid_on_port` with `kill`. `clean_stale_pid` removes PID file if process no longer exists (detected via `kill -0 $pid`). `cmd_start` fast-path exits if both ports pass `is_http_healthy`, otherwise kills stale processes, runs `nohup bun ...`, writes PIDs, waits for health.

## Behavioral Contracts

**Port constants:**
- `BACKEND_PORT=3456`
- `VITE_PORT=5174`

**Health polling:**
- Max wait: 60 seconds
- Poll interval: 1 second
- HTTP acceptable codes: 2xx, 3xx

**ANSI color codes:**
- `RED='\033[0;31m'`
- `GREEN='\033[0;32m'`
- `YELLOW='\033[1;33m'`
- `CYAN='\033[0;36m'`
- `NC='\033[0m'` (reset)

**Shell options:** `set -euo pipefail`